name: CI — Build & Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: Validate Project Structure
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check Xcode project file
        run: |
          if [ ! -s LandscapeDesigner.xcodeproj/project.pbxproj ]; then
            echo "ERROR: Xcode project file is empty or missing!"
            echo "LandscapeDesigner.xcodeproj/project.pbxproj is required for building."
            echo ""
            echo "To fix this:"
            echo "1. Open Xcode on your Mac"
            echo "2. Create a new iOS App project named 'LandscapeDesigner'"
            echo "3. Replace the project structure with the source files from LandscapeDesigner/Shared/"
            echo "4. Commit and push the fixed project file"
            exit 1
          fi
          echo "✓ Xcode project file is valid"

      - name: Show Xcode version
        run: xcodebuild -version

      - name: List available schemes
        run: xcodebuild -list -project LandscapeDesigner.xcodeproj || true

  # TODO: Enable these jobs once the Xcode project is properly configured
  # ios:
  #   name: Build & Test iOS
  #   runs-on: macos-latest
  #   needs: validate
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  # 
  #     - name: Build and test iOS
  #       run: |
  #         SIM=$(xcrun simctl list devices available | grep -m1 "iPhone" | awk -F '[()]' '{print $2}')
  #         echo "Using simulator: $SIM"
  #         xcodebuild \
  #           -project LandscapeDesigner.xcodeproj \
  #           -scheme LandscapeDesigner \
  #           -sdk iphonesimulator \
  #           -destination "id=$SIM" \
  #           CODE_SIGNING_ALLOWED=NO \
  #           build test
  # 
  # macos:
  #   name: Build & Test macOS
  #   runs-on: macos-latest
  #   needs: validate
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  # 
  #     - name: Build and test macOS
  #       run: |
  #         xcodebuild \
  #           -project LandscapeDesigner.xcodeproj \
  #           -scheme LandscapeDesigner \
  #           -sdk macosx \
  #           CODE_SIGNING_ALLOWED=NO \
  #           build test
